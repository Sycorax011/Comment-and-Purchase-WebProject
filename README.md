# 高并发票务抢购与点评系统 

## 项目概述

这是一个基于 Java 的全栈 Web 应用，专为高并发场景设计，结合了票务抢购（类似于猫眼的秒杀活动）和点评社交功能（灵感来源于大众点评）。系统能够处理促销或活动期间的瞬时流量峰值，同时确保数据一致性。重点关注后端性能优化，前端交互相对简单，前端资源在 src/main/resources/nginx-1.18.0 下。

关键亮点：
- **高并发处理**：使用 Redis 进行库存预扣减和 RabbitMQ 实现异步处理，以管理峰值负载。
- **核心业务逻辑**：实现了安全的登录验证、票务抢购（秒杀）、用户关注、发帖点评以及博客推送功能。
- 以 Spring Boot 为核心框架，强调可扩展性和可靠性。

## 技术栈

| 类别           | 技术                                | 描述                                           |
| -------------- | ----------------------------------- | ---------------------------------------------- |
| **后端框架**   | Spring Boot 2.7.4                   | 构建应用核心并处理业务逻辑。                   |
| **持久化层**   | MyBatis-Plus 3.5.2                  | 简化 MySQL 的 CRUD 操作。                      |
| **数据库**     | MySQL 8.0.33                        | 存储用户、票务、订单、点评等数据。             |
| **缓存与并发** | Redis (配 Redisson 3.13.6)          | 分布式缓存、锁机制和库存预扣减，支持高吞吐量。 |
| **消息队列**   | RabbitMQ (Spring Boot Starter AMQP) | 异步处理订单，实现削峰填谷和系统解耦。         |
| **其他依赖**   | Lombok、Hutool 5.8.8、AspectJ       | 简化代码、工具类和切面编程。                   |
| **项目管理**   | Maven、Git                          | 依赖管理和构建。                               |
| **反向代理**   | Nginx                               | 用于负载均衡和静态资源处理。                   |

## 已实现功能

### 1. 用户模块
- **登录验证**：支持安全的用户注册、登录和会话管理，使用 Redis 存储 Token。
- **用户关注**：用户可以关注其他用户，实现简单的好友系统。

### 2. 票务抢购模块（秒杀）
- **高并发抢购**：基于 Redis + Lua 脚本进行库存预校验和一人一单限制，防止超卖和重复下单。
- **异步订单处理**：抢购成功后，通过 RabbitMQ 异步写入数据库，确保低延迟响应。
- **数据一致性**：使用 Redisson 分布式锁和数据库乐观锁保障最终一致性。

### 3. 点评与社交模块
- **发帖点评**：用户可以发布博客、点评或帖子，支持文本和简单媒体。
- **推送功能**：基于关注关系，实现博客或帖子的推送通知。

### 4. 其他优化
- **缓存加速**：热点数据（如用户信息、库存）使用 Redis 缓存，减少数据库压力。
- **消息可靠性**：RabbitMQ 配置发布确认和手动 ACK，确保消息不丢失。

## 技术细节

以下列出项目中一些关键的技术实现细节，基于高并发和数据一致性的设计方案：

### 1. Redis 在高并发中的应用
- **Lua 脚本原子操作**：在 Redis 中使用 Lua 脚本原子性地执行库存校验、用户资格校验（一人一单）和预扣减库存。示例：通过 `DefaultRedisScript` 加载 Lua 脚本，实现单次 Redis 调用完成多步操作，提升 QPS。
- **手写分布式锁**：在集群环境下，使用 `RLock` 对用户 ID 加锁，防止多个消费者并发处理导致重复下单。
- **缓存优化**：热点数据预热到 Redis，解决缓存击穿、缓存穿透和缓存雪崩问题。

### 2. RabbitMQ 异步处理
- **生产者确认机制**：启用 `publish-confirm-type: correlated`，实现异步回调处理失败消息，支持重试或补偿逻辑。
- **消费者手动 ACK**：采用手动确认模式，仅在业务逻辑（如数据库写入）成功后发送 ACK，确保消息可靠性和至少一次投递（At-Least-Once）。
- **削峰填谷**：秒杀接口预扣库存后立即返回成功，将订单对象推入队列，后台消费者平稳处理数据库操作，解耦前端与后端。

### 3. 数据库一致性保障
- **乐观锁**：使用 MyBatis-Plus 的 `update().setSql("stock = stock - 1").gt("stock", 0)` 防止库存超卖。
- **唯一约束**：在订单表中添加 `(user_id, voucher_id)` 唯一索引，利用数据库原子性保证一人一单，无需应用层额外查询。
- **事务边界**：明确 `@Transactional` 只管理数据库操作，无法跨 Redis/RabbitMQ，因此引入消息队列解耦。

### 4. 其他细节
- **Maven 依赖管理**：pom.xml 中集成 Spring Boot Starter、MyBatis-Plus、Redis、RabbitMQ 等依赖，支持快速构建。
- **切面编程（AspectJ）**：用于日志记录或拦截器，实现非侵入式功能扩展。
- **工具类（Hutool）**：简化字符串、日期等操作，提高开发效率。

这些细节确保系统在高并发下保持高性能和数据正确性。项目从单一技术学习逐步集成，未来可扩展至微服务架构。

## 快速启动

### 1. 前置环境
- JDK 8+
- Maven 3.6+
- MySQL 8.0+
- Redis 7.x+
- RabbitMQ（独立安装或 Docker）

### 2. 克隆与构建
1. 克隆仓库：
   ```
   git clone https://github.com/Sycorax011/Comment-and-Purchase-WebProject.git
   ```
   
2. 配置应用：
   
- 记得修改 `application.yml` 中的数据库、MP、Redis 和 RabbitMQ 连接信息。
   
3. 构建并运行。
   
4. 如果需要反向代理等功能，可自行修改 Nginx 配置文件，项目文件内自带。





**如果您有任何问题或建议，欢迎在 GitHub 上提交 Issue 或 Pull Request！**